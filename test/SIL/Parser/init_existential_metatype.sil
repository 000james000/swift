// RUN: %target-swift-frontend -parse-sil %s -c -S -o -

// Make sure that we can successfully parse init_existential_metatype and irgen
// without crashing.

public protocol Any2 {}
public protocol P {}
public protocol PP : P {}

public class C : Any2 {
}

sil @non_opaque_existential : $@convention(thin) () -> @thick Any2.Type {
bb0:
  %0 = metatype $@thick C.Type
  %1 = init_existential_metatype %0 : $@thick C.Type, $@thick Any2.Type, C: Any2 module Test
  return %1 : $@thick Any2.Type
}

sil hidden @opaque_existential : $@convention(thin) (@thick PP.Type) -> @thick P.Type {
bb0(%0 : $@thick PP.Type):
  %1 = open_existential_metatype %0 : $@thick PP.Type to $@thick (@opened("619073B0-4518-11E5-A67F-985AEB89C610") PP).Type
  %2 = init_existential_metatype %1 : $@thick (@opened("619073B0-4518-11E5-A67F-985AEB89C610") PP).Type, $@thick P.Type, opaque
  return %2 : $@thick P.Type
}

sil_vtable C {
}
