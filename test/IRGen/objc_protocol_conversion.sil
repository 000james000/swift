// RUN: rm -rf %t/clang-module-cache
// RUN: %swift -target x86_64-apple-darwin10 -module-cache-path %t/clang-module-cache -sdk %S/Inputs -I=%S/Inputs -enable-source-import %s -emit-ir | FileCheck %s

sil_stage canonical

import Swift
import ObjectiveC

@objc protocol OP {}

// CHECK-LABEL: define %CSo8Protocol* @protocol_conversion() {
// CHECK:         %0 = load i8** @"\01l_OBJC_PROTOCOL_REFERENCE_$__TtP24objc_protocol_conversion2OP_", align 8
// CHECK:         %1 = bitcast i8* %0 to %CSo8Protocol*
// CHECK:         ret %CSo8Protocol* %1
// CHECK:       }

sil @protocol_conversion : $() -> @owned Protocol {
entry:
  %p = objc_protocol #OP : $Protocol
  return %p : $Protocol
}
