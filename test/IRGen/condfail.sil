// RUN: %target-swift-frontend -g -emit-ir %s | FileCheck %s

// REQUIRES: CPU=x86_64

import Builtin
import Swift

// Make sure we emit two traps.

// CHECK-LABEL: define hidden i64 @test_cond_fail(i64)
// CHECK:  call void @llvm.trap()
// CHECK:  call void @llvm.trap()
// CHECK: }

sil hidden @test_cond_fail : $@thin (Int) -> Int {
bb0(%0 : $Int):
  %2 = integer_literal $Builtin.Word, 1
  %3 = struct_extract %0 : $Int, #Int.value
  %4 = integer_literal $Builtin.Int1, -1
  %5 = builtin "sadd_with_overflow_Word"(%3 : $Builtin.Word, %2 : $Builtin.Word, %4 : $Builtin.Int1) : $(Builtin.Word, Builtin.Int1)
  %6 = tuple_extract %5 : $(Builtin.Word, Builtin.Int1), 0
  %7 = tuple_extract %5 : $(Builtin.Word, Builtin.Int1), 1
  cond_fail %7 : $Builtin.Int1
  %8 = builtin "sadd_with_overflow_Word"(%6 : $Builtin.Word, %2 : $Builtin.Word, %4 : $Builtin.Int1) : $(Builtin.Word, Builtin.Int1)
  %9 = tuple_extract %5 : $(Builtin.Word, Builtin.Int1), 1
  cond_fail %9 : $Builtin.Int1
  %10 = struct $Int (%6 : $Builtin.Word)
  return %10 : $Int
}
