// RUN: %swift -emit-ir %s | FileCheck %s
// XFAIL: linux

sil_stage canonical

import Builtin
import Swift
import SwiftShims

class Node {
  @sil_stored var index: Int { get set }
  init(index: Int)
  func check() -> Int
  @objc deinit 
}

class ParentNode : Node {
  init(left: Node, right: Node, index: Int)
  @objc deinit 
  override init(index: Int)
}

// pic_crash.Node.init (pic_crash.Node.Type)(index : Swift.Int) -> pic_crash.Node
sil @_TFC9pic_crash4Node5checkfS0_FT_Si : $@cc(method) @thin (@owned Node) -> () {
bb0(%0 : $Node):
  %1 = tuple () 
//CHECK-LABEL: @_TFC9pic_crash4Node5checkfS0_FT_Si
//CHECK:       load %swift.type
//CHECK-NEXT:  icmp eq %swift.type
//CHECK:       ret
  checked_cast_br [exact] %0 : $Node to $ParentNode, bb2, bb3 // id: %2

bb1:                                   // Preds: bb2 bb3
  return %1 : $()                                // id: %4

bb2(%5 : $ParentNode):                            // Preds: bb0
  br bb1                               // id: %10

bb3:                                              // Preds: bb0
  br bb1                              // id: %12
}

sil @_TFC9pic_crash4NodecfMS0_FT5indexSi_S0_ : $@cc(method) @thin (Int, @owned Node) -> @owned Node 
sil @_TFC9pic_crash4NodeCfMS0_FT5indexSi_S0_ : $@thin (Int, @thick Node.Type) -> @owned Node 
sil [transparent] @_TFC9pic_crash4Nodeg5indexSi : $@cc(method) @thin (@owned Node) -> Int 
sil [transparent] @_TFC9pic_crash4Nodes5indexSi : $@cc(method) @thin (Int, @owned Node) -> () 
sil @_TFC9pic_crash10ParentNodecfMS0_FT4leftCS_4Node5rightS1_5indexSi_S0_ : $@cc(method) @thin (@owned Node, @owned Node, Int, @owned ParentNode) -> @owned ParentNode 
sil @_TFC9pic_crash10ParentNodeCfMS0_FT4leftCS_4Node5rightS1_5indexSi_S0_ : $@thin (@owned Node, @owned Node, Int, @thick ParentNode.Type) -> @owned ParentNode 
sil @_TFC9pic_crash10ParentNoded : $@cc(method) @thin (@owned ParentNode) -> @owned Builtin.NativeObject 
sil @_TFC9pic_crash10ParentNodeD : $@cc(method) @thin (@owned ParentNode) -> () 
sil @_TFC9pic_crash10ParentNodecfMS0_FT5indexSi_S0_ : $@cc(method) @thin (Int, @owned ParentNode) -> @owned ParentNode 
sil @_TFC9pic_crash10ParentNodeCfMS0_FT5indexSi_S0_ : $@thin (Int, @thick ParentNode.Type) -> @owned ParentNode 

sil_vtable Node {
  #Node.init!initializer.1: _TFC9pic_crash4NodecfMS0_FT5indexSi_S0_	// pic_crash.Node.init (pic_crash.Node.Type)(index : Swift.Int) -> pic_crash.Node
  #Node.check!1: _TFC9pic_crash4Node5checkfS0_FT_Si	// pic_crash.Node.check (pic_crash.Node)() -> Swift.Int
  #Node.index!getter.1: _TFC9pic_crash4Nodeg5indexSi	// pic_crash.Node.index.getter : Swift.Int
  #Node.index!setter.1: _TFC9pic_crash4Nodes5indexSi	// pic_crash.Node.index.setter : Swift.Int
}

sil_vtable ParentNode {
  #Node.init!initializer.1: _TFC9pic_crash10ParentNodecfMS0_FT5indexSi_S0_	// pic_crash.ParentNode.init (pic_crash.ParentNode.Type)(index : Swift.Int) -> pic_crash.ParentNode
  #Node.check!1: _TFC9pic_crash4Node5checkfS0_FT_Si	// pic_crash.Node.check (pic_crash.Node)() -> Swift.Int
  #Node.index!getter.1: _TFC9pic_crash4Nodeg5indexSi	// pic_crash.Node.index.getter : Swift.Int
  #Node.index!setter.1: _TFC9pic_crash4Nodes5indexSi	// pic_crash.Node.index.setter : Swift.Int
  #ParentNode.init!initializer.1: _TFC9pic_crash10ParentNodecfMS0_FT4leftCS_4Node5rightS1_5indexSi_S0_	// pic_crash.ParentNode.init (pic_crash.ParentNode.Type)(left : pic_crash.Node, right : pic_crash.Node, index : Swift.Int) -> pic_crash.ParentNode
}

