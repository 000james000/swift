//===--- SILNodes.def - Swift SIL Metaprogramming ---------------*- C++ -*-===//
//
// This source file is part of the Swift.org open source project
//
// Copyright (c) 2014 - 2015 Apple Inc. and the Swift project authors
// Licensed under Apache License v2.0 with Runtime Library Exception
//
// See http://swift.org/LICENSE.txt for license information
// See http://swift.org/CONTRIBUTORS.txt for the list of Swift project authors
//
//===----------------------------------------------------------------------===//
//
// This file defines macros used for macro-metaprogramming with SIL nodes.
//
//===----------------------------------------------------------------------===//

/// VALUE(Id, Parent)
///   The expression enumerator value is an ValueKind.  The node's class name is
///   Id, and the name of its base class (in the SILValue hierarchy) is Parent.
#ifndef VALUE
#define VALUE(Id, Parent)
#endif

/// INST(Id, Parent)
///   The expression enumerator value is an ValueKind.  The node's class name is
///   Id, and the name of its base class (in the SILInstruction hierarchy) is
///   Parent.
#ifndef INST
#define INST(Id, Parent) VALUE(Id, Parent)
#endif

/// An abstract instruction is an abstract base class in the hierarchy;
/// it is never a most-derived type, and it does not have an enumerator in
/// ValueKind.
///
/// Most metaprograms do not care about abstract expressions, so the default
/// is to ignore them.
#ifndef ABSTRACT_VALUE
#define ABSTRACT_VALUE(Id, Parent)
#endif

/// A convenience for determining the range of values.  These will always
/// appear immediately after the last member.
#ifndef VALUE_RANGE
#define VALUE_RANGE(Id, First, Last)
#endif

VALUE(SILArgument, SILValue)

ABSTRACT_VALUE(SILInstruction, SILValue)
  ABSTRACT_VALUE(AllocInst, SILInstruction)
    INST(AllocVarInst, AllocInst)
    INST(AllocRefInst, AllocInst)
    VALUE_RANGE(AllocInst, AllocVarInst, AllocRefInst)
  INST(AllocBoxInst, SILInstruction)
  INST(AllocArrayInst, SILInstruction)
  INST(ConstantRefInst, SILInstruction)

  ABSTRACT_VALUE(FunctionInst, SILInstruction)
    INST(ApplyInst, FunctionInst)
    INST(PartialApplyInst, FunctionInst)
    VALUE_RANGE(FunctionInst, ApplyInst, PartialApplyInst)

  // Literals
  INST(IntegerLiteralInst, SILInstruction)
  INST(FloatLiteralInst, SILInstruction)
  INST(StringLiteralInst, SILInstruction)

  INST(LoadInst, SILInstruction)
  INST(StoreInst, SILInstruction)
  INST(InitializeVarInst, SILInstruction)
  INST(CopyAddrInst, SILInstruction)
  INST(SpecializeInst, SILInstruction)
  INST(TupleInst, SILInstruction)
  INST(ClassMetatypeInst, SILInstruction)
  INST(ArchetypeMetatypeInst, SILInstruction)
  INST(ProtocolMetatypeInst, SILInstruction)
  INST(MetatypeInst, SILInstruction)
  INST(ModuleInst, SILInstruction)
  INST(AssociatedMetatypeInst, SILInstruction)
  INST(ExtractInst, SILInstruction)
  INST(ElementAddrInst, SILInstruction)
  INST(RefElementAddrInst, SILInstruction)
  
  ABSTRACT_VALUE(DynamicMethodInst, SILInstruction)
    INST(ArchetypeMethodInst, DynamicMethodInst)
    INST(ProtocolMethodInst, DynamicMethodInst)
    INST(ClassMethodInst, DynamicMethodInst)
    INST(SuperMethodInst, DynamicMethodInst)
    VALUE_RANGE(DynamicMethodInst, ArchetypeMethodInst, SuperMethodInst)
    
  INST(ProjectExistentialInst, SILInstruction)
  INST(InitExistentialInst, SILInstruction)
  INST(UpcastExistentialInst, SILInstruction)
  INST(DeinitExistentialInst, SILInstruction)

  INST(RetainInst, SILInstruction)
  INST(ReleaseInst, SILInstruction)
  INST(DeallocVarInst, SILInstruction)
  INST(DeallocRefInst, SILInstruction)
  INST(DestroyAddrInst, SILInstruction)
  
  ABSTRACT_VALUE(ConversionInst, SILInstruction)
    INST(ConvertFunctionInst, ConversionInst)
    INST(CoerceInst, ConversionInst)
    INST(UpcastInst, ConversionInst)
    INST(DowncastInst, ConversionInst)
    INST(AddressToPointerInst, ConversionInst)
    INST(ThinToThickFunctionInst, ConversionInst)
    INST(ArchetypeToSuperInst, ConversionInst)
    VALUE_RANGE(ConversionInst, ConvertFunctionInst, ArchetypeToSuperInst)
  INST(SuperToArchetypeInst, SILInstruction)

  // SIL-only instructions that don't have an AST analog.
  INST(IndexAddrInst, SILInstruction)
  INST(IntegerValueInst, SILInstruction)

  // Terminators.
  ABSTRACT_VALUE(TermInst, SILInstruction)
    INST(UnreachableInst, TermInst)
    INST(ReturnInst, TermInst)
    INST(BranchInst, TermInst)
    INST(CondBranchInst, TermInst)
    VALUE_RANGE(TermInst, UnreachableInst, CondBranchInst)

  VALUE_RANGE(SILInstruction, AllocVarInst, CondBranchInst)

#undef VALUE_RANGE
#undef ABSTRACT_VALUE
#undef INST
#undef VALUE
